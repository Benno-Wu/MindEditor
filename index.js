!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var a in n)("object"==typeof exports?exports:e)[a]=n[a]}}(self,(function(){return function(){"use strict";var e,t={6630:function(e,t,n){n.r(t);var a={};n.r(a),n.d(a,{defa:function(){return xe},file:function(){return Se},fish:function(){return Ne},righ:function(){return Ze},stru:function(){return Oe},tian:function(){return Te}});var r={};n.r(r),n.d(r,{classic:function(){return Pe},classic_compact:function(){return De},fish:function(){return Ae},fresh_blue:function(){return Me},fresh_blue_compat:function(){return Re},fresh_green:function(){return Fe},fresh_green_compat:function(){return Le},fresh_pink:function(){return _e},fresh_pink_compat:function(){return Ue},fresh_purple:function(){return je},fresh_purple_compat:function(){return Ie},fresh_red:function(){return We},fresh_red_compat:function(){return Be},fresh_soil:function(){return ze},fresh_soil_compat:function(){return He},snow:function(){return $e},snow_compact:function(){return Ve},tianpan:function(){return qe},tianpan_compact:function(){return Je},wire:function(){return Ge}});var o={};n.r(o),n.d(o,{en_US:function(){return Xe},zh_CN:function(){return Ke}});var i=n(7294),l=n(3935),s=n(434),c=(n(6699),n(3809)),d=n(2787),u=n(4643),p=n(5740),m=n(1577),g=n(5241),f=n(6491),h=n(9120),v=n(924),y=n(5233),b=n(2779),E=n(258),w=n(6570),k=n(643),C=n(9510),x=n(6139),S=n(1059),N=n(2850),Z=n(8212),O=n(2877),T=n(9562),D=n(2044),P=n(9008),A=n(4962),R=n(8547),M=n(6043),L=n(4549);const F=()=>(0,i.useReducer)((()=>[]),[])[1],U=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"click";(0,i.useEffect)((()=>{const a=n=>{(Array.isArray(t)?t:[t]).every((e=>{const t="function"==typeof e?e():e&&"current"in e?e.current:e;return t&&!t.contains(n.target)}))&&e(n)};return document.addEventListener(n,a,!0),()=>document.removeEventListener(n,a,!0)}),[e,t,n])},_=e=>{let{onDragStart:t,onDragEnd:n,dataTransfer:a}=e;return{draggable:!0,onDragStart:e=>{for(const[t,n]of Object.entries(a??{}))e.dataTransfer.setData(t,n);null==t||t(e)},onDragEnd:n}},I=e=>{let{onDragEnter:t,onDragLeave:n,onDragOver:a,onDrop:r}=e;return{onDragOver:e=>{e.preventDefault(),null==a||a(e)},onDragEnter:t,onDragLeave:n,onDrop:r}};var j=n(3171);const B=(0,i.createContext)(void 0),W=(0,i.createContext)(void 0);var H=n(4478);const z=(0,i.forwardRef)(((e,t)=>{let{tags:n=[]}=e;const{t:a}=(0,H.$)(),{minder:r,mindOnOff:o}=(0,i.useContext)(B),l=(null==r?void 0:r.queryCommandValue("Resource"))??[],[s,c]=(0,i.useState)(n),d=F();(0,i.useImperativeHandle)(t,(()=>({getLatestTag:()=>s}))),(0,i.useEffect)((()=>o({selectionchange:d})),[o,d]);const u=(e,t)=>{null==r||r.execCommand("Resource",t?l.filter((t=>t!==e)):l.concat(e)),d()};return i.createElement("div",{className:"minder-drag-tags"},i.createElement("input",{placeholder:`+ ${a("MainDrawer.tag")}`,onBlur:e=>{const t=e.target.value;t.length&&!s.includes(t)&&c((e=>[...e,t])),e.target.value=""},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()}}),i.createElement("div",{className:"tags"},s.map((e=>i.createElement("div",{key:e,className:l.includes(e)?"tag selected":"tag",style:{backgroundColor:null==r?void 0:r.getResourceColor(e).toHEX()},draggable:!0,onDragStart:t=>{t.dataTransfer.setData("tag",e),t.dataTransfer.dropEffect="move"},onClick:()=>u(e,l.includes(e))},e)))," "),i.createElement("div",{className:"delete",onDragOver:e=>e.preventDefault(),onDrop:e=>{const t=e.dataTransfer.getData("tag");c(s.filter((e=>e!==t))),e.stopPropagation()}},i.createElement(j.Z,{className:"trashBin"})),i.createElement("div",{className:"error"},l.filter((e=>!s.includes(e))).map((e=>i.createElement("div",{key:e,className:"out",onClick:()=>{u(e,!0)}},e)))))}));var V=n(6832);const $=(e,t,n)=>{const a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(e instanceof Blob?e:new Blob(Array.isArray(e)?e:[JSON.stringify(e)],n)),document.body.appendChild(a),a.click(),document.body.removeChild(a)};var J=n(7441);const q=["AppendParentNode","AppendSiblingNode","AppendChildNode","RemoveNode","ArrangeUp","ArrangeDown","ExpandToLevel","Expand","Template","Theme","Priority","Progress","Resource","Extra","ResetLayout","Zoom","ZoomIn","ZoomOut","Camera","Hand","Text","Image","Note","HyperLink","Background","Copy","Paste","Cut"];var G=n(4901);function K(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,ee(e,t,"get"))}function Q(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,ee(e,t,"set"),n),n}function ee(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var te=new WeakMap,ne=new WeakMap,ae=new WeakMap,re=new WeakMap,oe=new WeakMap,ie=new WeakMap;class le{constructor(e){var t;K(this,te,{writable:!0,value:void 0}),K(this,ne,{writable:!0,value:void 0}),K(this,ae,{writable:!0,value:!1}),K(this,re,{writable:!0,value:[]}),K(this,oe,{writable:!0,value:[]}),X(this,"undos",(()=>Y(this,re))),X(this,"redos",(()=>Y(this,oe))),X(this,"reset",(()=>{Q(this,re,[]),Q(this,oe,[]),Q(this,ne,Y(this,te).exportJson())})),X(this,"redo",(()=>{Q(this,ae,!0);const e=Y(this,oe).pop();null!=e&&e.length&&(Y(this,te).applyPatches(e),Y(this,ie).call(this)),Q(this,ae,!1)})),X(this,"undo",(()=>{Q(this,ae,!0);const e=Y(this,re).pop();if(null!=e&&e.length){Y(this,te).applyPatches(e);const t=Y(this,te).exportJson(),n=(0,G.qu)(t,Y(this,ne));Y(this,oe).push(n),Q(this,ne,t)}Q(this,ae,!1)})),X(this,"do",(()=>{!Y(this,ae)&&Y(this,ie).call(this)&&Q(this,oe,[])})),K(this,ie,{writable:!0,value:()=>{const e=Y(this,te).exportJson(),t=(0,G.qu)(e,Y(this,ne));if(t.length){for(Y(this,re).push(t);Y(this,re).length>le.MAX_HISTORY;)Y(this,re).shift();return Q(this,ne,e),!0}return!1}}),Q(this,te,e),Q(this,ne,null===(t=Y(this,te))||void 0===t?void 0:t.exportJson())}}X(le,"MAX_HISTORY",100);var se=n(6961);n(8675),n(3462),n(7380),n(1118);var ce=n(6751),de=n(5794),ue=n(4618),pe=n(1670),me=n(8094),ge=n(8965),fe=n(2603),he=n(8988),ve=n(2504),ye=n(6130),be=n(4557),Ee=n(2602);const we=e=>{let{keys:t}=e;const n=t.split(/,/);return i.createElement(i.Fragment,null,n.map(((e,t)=>i.createElement("span",{key:t},i.createElement("span",{className:"keyboard"},e),t+1===n.length?"  ":", "))))},ke=["Enter","Tab,Insert","Shift+Tab","Delete","Up,Down,Left,Right","Alt+Up,Down","/,、","Alt+1,2,3,4,5","Alt+`","E","Ctrl+A","Ctrl+C","Ctrl+X","Ctrl+V","Ctrl+B","Ctrl+I","Ctrl+F","Alt+LeftMouse,RightMouse","MouseWheel,TouchPad","dblclick blank","Ctrl++,-,MouseWheel","Ctrl+Shift+L","Ctrl+Z","Ctrl+Y"],Ce=e=>{let{cols:t=1,renderOptions:n,options:a=n,onSelect:r,children:o}=e;const[l,s]=(0,i.useState)(!1),c=i.createElement("div",{className:"hover-select",style:{gridTemplateColumns:`repeat(${t},1fr)`}},n.map(((e,t)=>i.createElement("div",{className:"item",key:t,style:{cursor:"pointer"},onClick:()=>{s(!1),r(a[t],t,a)}},e))));return i.createElement(g.Z,{visible:l,content:c,onVisibleChange:s},o)};var xe=n.p+"static/images/template/default.png",Se=n.p+"static/images/template/filetree.png",Ne=n.p+"static/images/template/fish-bone.png",Ze=n.p+"static/images/template/right.png",Oe=n.p+"static/images/template/structure.png",Te=n.p+"static/images/template/tianpan.png",De=n.p+"static/images/theme/classic-compact.png",Pe=n.p+"static/images/theme/classic.png",Ae=n.p+"static/images/theme/fish.png",Re=n.p+"static/images/theme/fresh-blue-compat.png",Me=n.p+"static/images/theme/fresh-blue.png",Le=n.p+"static/images/theme/fresh-green-compat.png",Fe=n.p+"static/images/theme/fresh-green.png",Ue=n.p+"static/images/theme/fresh-pink-compat.png",_e=n.p+"static/images/theme/fresh-pink.png",Ie=n.p+"static/images/theme/fresh-purple-compat.png",je=n.p+"static/images/theme/fresh-purple.png",Be=n.p+"static/images/theme/fresh-red-compat.png",We=n.p+"static/images/theme/fresh-red.png",He=n.p+"static/images/theme/fresh-soil-compat.png",ze=n.p+"static/images/theme/fresh-soil.png",Ve=n.p+"static/images/theme/snow-compact.png",$e=n.p+"static/images/theme/snow.png",Je=n.p+"static/images/theme/tianpan-compact.png",qe=n.p+"static/images/theme/tianpan.png",Ge=n.p+"static/images/theme/wire.png";const Ke={Iam:"中文",Message:{unsupportImage:"不支持的图片格式",sameFilename:"文件名称有冲突，已使用旧文件",contentFileNotFound:"核心数据文件未找到",imageLoadFailButLink:"图片加载失败，已转为链接",directoryNotSupported:"暂时不支持文件夹",imageOrLinkNotRecognized:"未识别到图片或者链接",copy2clipboard:"已复制到剪切板",fail2share:"分享链接生成失败",fail2export:"文件导出失败",fail2import:"文件导入失败",unsupportFile:"不支持的文件格式",imageLoadFail_UseLinkInstead:"图片下载失败，已切换为链接加载模式",invalidLink:"无效的链接",file:"文件",loadFails_reasonIs:"加载失败，原因是",GFMSupported:"支持GFM语法",NoFileUploaded_NoNodeSelected:"未上传文件或者未选中节点",NoNodeSelected:"未选中节点","FileDeleteConfirm?":"确定删除该文件吗？",CanNotUndone:"无法撤销"},Operation:{share:"分享",export:"导出",import:"导入",redo:"重做",undo:"撤销",search:"搜索",appendParent:"+父节点",appendSibling:"+兄弟节点",appendChild:"+子节点",arrangeUp:"上移",arrangeDown:"下移",edit:"编辑",text:"文字",delete:"删除",link:"链接",linkHint:"粘贴超链接",image:"图片",imageHint:"粘贴图片地址",imageUploadHint:"双击上传图片",note:"备注",extra:"附件",priority:"优先级",progress:"进度",reset:"还原",tag:"标签",remove:"移除",back:"返回"},MainDrawer:{tag:"标签",allResources:"所有资源"},MultiSelect:{all:"全选",revert:"反选",siblings:"兄弟",level:"同级",path:"路径",tree:"子树"},Statusbar:{preview:"预览",copied:"已复制图片到剪切板",permission:"请在浏览器相关设置中，授予剪切板访问权限",template:"结构样式",theme:"主题",resetLayout:"规整某选中节点布局，默认全部",selectOrDrag:"选择/拖拽移动",center:"居中显示",editable:"编辑锁定",shortcut:"快捷键",language:"语言",selection:"当前选中",unknown:"未知",node:"个节点",expand:"展开",select:"选择",focus:"获得焦点",blur:"失去焦点"},Shortcuts:{Enter:"+兄弟节点","Tab,Insert":"+子节点","Shift+Tab":"+父节点",Delete:"删除节点","Up,Down,Left,Right":"节点导航","Alt+Up,Down":"上/下移","/,、":"展开/收起","Alt+1,2,3,4,5":"展开至层级N","Alt+`":"展开全部",E:"编辑","Ctrl+A":"全选","Ctrl+C":"复制","Ctrl+X":"剪切","Ctrl+V":"粘贴","Ctrl+B":"加粗","Ctrl+I":"斜体","Ctrl+F":"搜索","Alt+LeftMouse,RightMouse":"Alt+左键,右键 拖动视野","MouseWheel,TouchPad":"鼠标滚轮/触摸板 移动视野","dblclick blank":"双击空白处 居中显示","Ctrl++,-,MouseWheel":"缩放","Ctrl+Shift+L":"规整布局","Ctrl+Z":"撤销","Ctrl+Y":"重做"}},Xe={Iam:"English",Message:{unsupportImage:"Image format is not supported",sameFilename:"File name conflicts, using the old file",contentFileNotFound:"Core/Data File not found",imageLoadFailButLink:"Failed to load image, using as link",directoryNotSupported:"Directory not supported for now",imageOrLinkNotRecognized:"Image or link not recognized",copy2clipboard:"Copied to clipboard",fail2share:"Share link failed to generate",fail2export:"Failed to export",fail2import:"Failed to import",unsupportFile:"Unsupported file format",imageLoadFail_UseLinkInstead:"Failed to load image, using online link now",invalidLink:"Invalid link",file:"File",loadFails_reasonIs:"Failed to load, the reason is",GFMSupported:"GFM supported",NoFileUploaded_NoNodeSelected:"No File uploaded or no Node selected",NoNodeSelected:"No Node selected","FileDeleteConfirm?":"Are you sure to delete this file?",CanNotUndone:"Cannot be undone"},Operation:{share:"Share",export:"Export",import:"Import",redo:"Redo",undo:"Undo",search:"Search",appendParent:"+Parent Node",appendSibling:"+Sibling Node",appendChild:"+Child Node",arrangeUp:"Arrange Up",arrangeDown:"Arrange Down",edit:"Edit",text:"Text",delete:"Delete",link:"Link",linkHint:"paste link",image:"Image",imageHint:"paste image's link",imageUploadHint:"dblclick to upload image",note:"Note",extra:"File",priority:"Priority",progress:"Progress",reset:"reset",tag:"Tag",remove:"Remove",back:"Back"},MainDrawer:{tag:"Tag",allResources:"All Resources"},MultiSelect:{all:"All",revert:"Revert",siblings:"Siblings",level:"Level",path:"Path",tree:"Tree"},Statusbar:{preview:"Preview",copied:"Image copied to Clipboard",permission:"Please grant the clipboard access in your browser settings",template:"Template",theme:"Theme",resetLayout:"Reset node's layout, default all",selectOrDrag:"Select / Drag",center:"Center",editable:"Editable",shortcut:"Shortcut",language:"Language",selection:"Selected",unknown:"Unknown",node:"node(s)",expand:"Expand",select:"Select",focus:"GotFocus",blur:"LostFocus"},Shortcuts:{Enter:"+SiblingNode","Tab,Insert":"+ChildNode","Shift+Tab":"+ParentNode",Delete:"Delete node","Up,Down,Left,Right":"Navigation","Alt+Up,Down":"Arrange up/down","/,、":"Expand/Collpose","Alt+1,2,3,4,5":"Expand to level N","Alt+`":"Expand all",E:"Edit","Ctrl+A":"Select All","Ctrl+C":"Copy","Ctrl+X":"Cut","Ctrl+V":"Paste","Ctrl+B":"Bold","Ctrl+I":"Italic","Ctrl+F":"Search","Alt+LeftMouse,RightMouse":"Drag view","MouseWheel,TouchPad":"Move view","dblclick blank":"center","Ctrl++,-,MouseWheel":"Zoom","Ctrl+Shift+L":"Reset layout","Ctrl+Z":"Undo","Ctrl+Y":"Redo"}},Ye=e=>t=>e.test(t),Qe=Ye(/\.|\/(jpeg|jpg|png|gif)$/i),et=Ye(/^data:image\/\w*(;.*)*;base64,/),tt=Ye(/^([a-z]([a-z\d\+\-\.])*:)?\/\//i),nt=(Function.prototype.call.bind(Object.prototype.hasOwnProperty),(e,t)=>{const n=document.createElement("link");n.id=e,n.rel="stylesheet",n.type="text/css",n.href=t,document.body.appendChild(n)}),at={antdDark:"./static/antd.dark.min.css",customDark:"./static/dark-mode.css"},rt={superDark:"./static/super-dark-mode.css"},ot=["all","revert","siblings","level","path","tree"],it=()=>{var e,t;const n=F(),{t:l}=(0,H.$)(),{minder:s,Commands:d,mindOnOff:u}=(0,i.useContext)(B),p=(0,i.useContext)(W),[f,h]=(0,i.useState)(""),[v,y]=(0,i.useState)([]),b=(0,i.useMemo)((()=>Object.keys(window.kityminder.Minder.getTemplateList())),[]),E=(0,i.useMemo)((()=>Object.keys(window.kityminder.Minder.getThemeList())),[]),[w,k]=(0,i.useState)(window.matchMedia("(prefers-color-scheme: dark)").matches);(0,i.useEffect)((()=>{w&&Object.entries(at).forEach((e=>nt(...e)))}),[]);const C=(0,i.useCallback)((e=>{var t;const n=s.getSelectedNodes()??[];let a=[];switch(e){case"all":a=s.getAllNode()??[];break;case"revert":a=(null===(t=s.getAllNode())||void 0===t?void 0:t.filter((e=>!n.includes(e))))??[];break;case"siblings":n.forEach((e=>a.push(...e.parent.children.filter((e=>!n.includes(e))))));break;case"level":{const e=n.map((e=>e.getLevel()));a=s.getAllNode().filter((t=>e.includes(t.getLevel())))??[]}break;case"path":a=[...n],n.forEach((e=>{let t=e;for(;t.parent;)a.push(t=t.parent)}));break;case"tree":n.forEach((e=>{const t=[];e.traverse((e=>t.push(e))),a.push(...t)}))}s.select(a,!0)}),[s]);return(0,i.useEffect)((()=>u({selectionchange:e=>{let{minder:t}=e;const n=t.getSelectedNodes()??[];y(n),t.focus()}})),[u,s]),(0,i.useEffect)((()=>u({"focus blur zoom":n})),[u,n]),i.createElement("div",{className:"statusbar"},i.createElement("div",{className:"preview"},i.createElement(g.Z,{placement:"topLeft",onVisibleChange:async e=>{e&&h(await s.exportData("png"))},content:i.createElement(ce.Z,{src:f,style:{maxHeight:"50vh",maxWidth:"50vw"}})},i.createElement(m.Z,{type:"text",onClick:async()=>{const e=await(async e=>{var t;const{state:n}=await(null===(t=navigator.permissions)||void 0===t?void 0:t.query({name:"clipboard-write"}))??{};if("granted"!==n)return!1;const a=window.atob(e.split(",")[1]),r=new Uint8Array(a.length);for(let e=0;e<r.length;e++)r[e]=a.charCodeAt(e);const o=new Blob([r],{type:"image/png"});return navigator.clipboard.write([new ClipboardItem({[o.type]:o})]),!0})(await s.exportData("png"));c.ZP[e?"success":"error"](e?{content:l("Statusbar.copied"),style:{paddingTop:"40vh"},duration:1.5}:l("Statusbar.permission"))}},l("Statusbar.preview")))),i.createElement("div",{className:"templates"},i.createElement(Ce,{cols:2,options:b,onSelect:d.Template,renderOptions:b.map((e=>i.createElement("div",{id:"mindeditor-template",style:{backgroundImage:`url(${a[e.substr(0,4)]})`}})))},l("Statusbar.template"))),i.createElement("div",{className:"theme"},i.createElement(Ce,{cols:4,options:E,onSelect:d.Theme,renderOptions:E.map((e=>i.createElement("div",{id:"mindeditor-theme",style:{backgroundImage:`url(${r[e.replaceAll("-","_")]})`}})))},l("Statusbar.theme"))),i.createElement("div",{className:"expend"},i.createElement(g.Z,{content:i.createElement(de.Z,{style:{width:"200px"},defaultValue:1,max:10,dots:!0,tipFormatter:e=>10===e?"∞":e,onAfterChange:e=>d.ExpandToLevel(10===e?99:e)})},l("Statusbar.expand"))),i.createElement("div",{className:"select"},i.createElement(Ce,{cols:2,options:ot,onSelect:C,renderOptions:ot.map((e=>l(`MultiSelect.${e}`)))},l("Statusbar.select"))),i.createElement("div",{className:"multi"},i.createElement(g.Z,{content:l("Statusbar.resetLayout")},i.createElement(m.Z,{icon:i.createElement(ue.Z,null),onClick:d.ResetLayout})),i.createElement(g.Z,{content:l("Statusbar.selectOrDrag")},i.createElement(m.Z,{icon:s.queryCommandState("Hand")?i.createElement(pe.Z,null):i.createElement(me.Z,null),onClick:()=>{d.Hand(),n()}})),i.createElement(g.Z,{content:l("Statusbar.center")},i.createElement(m.Z,{icon:i.createElement(ge.Z,null),onClick:()=>{d.Camera()}})),i.createElement(g.Z,{content:l("Statusbar.editable")},i.createElement(m.Z,{icon:"readonly"===s.getStatus()?i.createElement(fe.Z,null):i.createElement(he.Z,null),danger:"readonly"===s.getStatus(),onClick:()=>{"readonly"===s.getStatus()?(s.enable(),s.setStatus("normal",!0)):s.disable(),n()}}))),i.createElement("div",{className:"selection"},i.createElement(g.Z,{content:i.createElement("div",{style:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"},onClickCapture:e=>{const t=Array.from(e.target.parentNode.childNodes).findIndex((t=>t===e.target));-1!==t&&(d.Camera(v[t]),s.select(v[t],!0),d.Expand(!0))}},v.map(((e,t)=>i.createElement("div",{key:t},null==e?void 0:e.getText()))))},l("Statusbar."+(s.isFocused()?"focus":"blur"))," ",l("Statusbar.selection"),": ",1===v.length?(null===(e=v[0])||void 0===e?void 0:e.getText())??l("Statusbar.unknown"):v.length+" "+l("Statusbar.node"))),i.createElement("div",{className:"zoom"},i.createElement(g.Z,{content:i.createElement(de.Z,{style:{width:"200px"},tipFormatter:e=>e+"%",defaultValue:100,min:100,max:500,step:20,onAfterChange:d.Zoom})},i.createElement(m.Z,{icon:i.createElement(ve.Z,null),onClick:()=>{d.ZoomIn()}})),i.createElement(Ce,{cols:2,renderOptions:(null===(t=s._options.zoom)||void 0===t?void 0:t.map((e=>e+"%")))??[],options:s._options.zoom,onSelect:d.Zoom},"  ",s.getZoomValue(),"%  "),i.createElement(g.Z,{content:i.createElement(de.Z,{style:{width:"200px"},tipFormatter:e=>e+"%",defaultValue:100,min:5,max:100,step:5,onAfterChange:d.Zoom})},i.createElement(m.Z,{icon:i.createElement(ye.Z,null),onClick:()=>{d.ZoomOut()}}))),i.createElement("div",{className:"shortcuts"},i.createElement(g.Z,{placement:"topRight",content:ke.map(((e,t)=>i.createElement("div",{key:t,id:"mindeditor-keyboard"},i.createElement(we,{keys:e}),l(`Shortcuts.${e}`))))},l("Statusbar.shortcut"))),i.createElement("div",{className:"language"},i.createElement(Ce,{renderOptions:Object.entries(o).map((e=>{let[t,n]=e;return i.createElement("div",null,n.Iam)})),options:Object.keys(o),onSelect:p},i.createElement(be.Z,null)," ",l("Statusbar.language"))),i.createElement("div",{className:"fullscreen"},i.createElement("div",{className:"mode",onClick:()=>{w?Object.keys({...at,...rt}).forEach((e=>{const t=document.getElementById(e);t&&document.body.removeChild(t)})):Object.entries(at).forEach((e=>nt(...e))),k((e=>!e))},onDoubleClick:()=>{w&&Object.entries(rt).forEach((e=>nt(...e)))}},w?"🌙":"☀"),i.createElement(m.Z,{icon:i.createElement(Ee.Z,null),onClick:()=>{var e;document.fullscreenElement?document.exitFullscreen():null===(e=document.getElementsByClassName("minder")[0])||void 0===e||e.requestFullscreen()}})))};var lt=n(5588),st=n(6965),ct=n(6609);const dt=new Map,ut=new Map,pt=["","start","oct","quarter","3oct","half","5oct","3quar","7oct","done"],mt={"@_id":(e,t)=>e.id=t,"@_timestamp":(e,t)=>e.created=t,"@_branch":(e,t)=>{"folded"===t&&(e.expandState="collapse")},title:(e,t)=>{e.text=(null==t?void 0:t["#text"])??t,e.text+=""},"@_xlink:href":(e,t)=>e.hyperlink=t,"xhtml:img":(e,t)=>{e.image=t["@_xhtml:src"],e.imageTitle=t["@_xhtml:src"].split("/").pop(),e.imageSize={width:t["@_svg:width"],height:t["@_svg:height"]}},"marker-refs":(e,t)=>{let n=t["marker-ref"];Array.isArray(n)||(n=[n]),n.forEach((t=>{const n=t["@_marker-id"];switch(!0){case n.includes("task"):e.progress=pt.findIndex((e=>e===n.split("-")[1]));break;case n.includes("priority"):e.priority=+n.split("-")[1]}}))},labels:(e,t)=>{e.resource=t.label},notes:(e,t)=>{e.note=t.plain}},gt=(e,t)=>{for(const n in e)Object.hasOwnProperty.call(mt,n)&&mt[n](t.data,e[n]);if(null!=e&&e.children){let n=e.children.topics.topic;Array.isArray(n)||(n=[n]),n.forEach((e=>{const n={data:{},children:[]};t.children.push(n),gt(e,n)}))}},ft={id:(e,t)=>e.id=t,branch:(e,t)=>{"folded"===t&&(e.expandState="collapse")},title:(e,t)=>e.text=t+"",image:(e,t)=>{e.image=t.src,e.imageTitle=t.src.split("/").pop(),e.imageSize={width:t.width,height:t.height}},href:(e,t)=>e.hyperlink=t,markers:(e,t)=>{t.forEach((t=>{const n=t.markerId;switch(!0){case n.includes("task"):e.progress=pt.findIndex((e=>e===n.split("-")[1]));break;case n.includes("priority"):e.priority=+n.split("-")[1]}}))},labels:(e,t)=>{e.resource=t},notes:(e,t)=>{e.note=t.plain.content}},ht=(e,t)=>{var n,a;for(const n in e)Object.prototype.hasOwnProperty.call(ft,n)&&ft[n](t.data,e[n]);null!=e&&null!==(n=e.children)&&void 0!==n&&null!==(a=n.attached)&&void 0!==a&&a.length&&e.children.attached.forEach((e=>{const n={data:{},children:[]};t.children.push(n),ht(e,n)}))},vt=async e=>{var t;const n=null===(t=e.data.image)||void 0===t?void 0:t.split("/").pop();if(n&&!/^(https?:)?\/\//.test(e.data.image??"")){const t=dt.get(n);var a,r;t&&(e.data.image=URL.createObjectURL(t),ut.set(n,e.data.image),null!==(a=e.data.imageSize)&&void 0!==a&&a.width&&null!==(r=e.data.imageSize)&&void 0!==r&&r.height||(e.data.imageSize=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.type,n=0,a=0;switch(!0){case"image/png"===t:{const t=await e.slice(16,24).arrayBuffer();n=new DataView(t).getUint32(0),a=new DataView(t).getUint32(4)}break;case["image/jpeg","image/jpg"].includes(t):{let t,r=1,o=0;const i=new Uint16Array(18);i.forEach(((e,t,n)=>n[t]=t+224)),i[16]=254,i[17]=219;do{if(r+=o+2,t=new DataView(await e.slice(r,r+1).arrayBuffer()).getUint8(0),!i.includes(t)){if(192===t)break;throw new Error("todo parser error")}o=new DataView(await e.slice(r+1,r+1+2).arrayBuffer()).getUint16(0)}while(192!==t);const l=await e.slice(r+4,r+4+4).arrayBuffer();n=new DataView(l).getUint16(2),a=new DataView(l).getUint16(0)}break;case"image/gif"===t:{const t=await e.slice(6,10).arrayBuffer();n=new DataView(t).getUint16(0,!0),a=new DataView(t).getUint16(2,!0)}}return{width:n,height:a}}(t,`image/${n.split(".").pop()}`)))}for(const t of e.children)await vt(t)};class yt{static async parseKm2(e){let t;const n=new lt.Mr(new lt.Nt(e)),a=await n.getEntries(),r=a.filter((e=>e.filename.includes("content.json")))[0];if(!r)throw c.ZP.warn(ct.ZP.t("Message.contentFileNotFound")),new Error;var o;t=JSON.parse(await(null===(o=r.getData)||void 0===o?void 0:o.call(r,new lt.Ek,{useWebWorkers:!0}))??"");const i=[],l=[];for(const e of a){const t=e.filename.split("/");"files"===t[0]&&e.getData&&(i.push(t[1]),l.push(e.getData(new lt.U5,{useWebWorkers:!0})))}return(await Promise.allSettled(l)).forEach(((e,t)=>{"fulfilled"===e.status?dt.set(i[t],e.value):c.ZP.warn(ct.ZP.t("Message.file")+" "+i[t]+" "+ct.ZP.t("Message.loadFails_reasonIs")+e.reason)})),await vt(t.root),await n.close(),t}static async parseXmind(e){const t={template:"default",theme:"fresh-blue",version:"2.0.0",root:{data:{},children:[]}},n=new lt.Mr(new lt.Nt(e)),a=await n.getEntries(),r=a.filter((e=>e.filename.includes("content")));let o=r.find((e=>e.filename.endsWith(".json")));if(o){var i,l;const e=JSON.parse(await(null===(i=(l=o).getData)||void 0===i?void 0:i.call(l,new lt.Ek,{useWebWorkers:!0}))??"");ht(e[0].rootTopic,t.root)}else{if(!(o=r.find((e=>e.filename.endsWith(".xml")))))throw c.ZP.warn(ct.ZP.t("Message.contentFileNotFound")),new Error;{var s,d;const e=await(null===(s=(d=o).getData)||void 0===s?void 0:s.call(d,new lt.Ek,{useWebWorkers:!0}))??"",n=st.parse(e,{ignoreAttributes:!1});gt(n["xmap-content"].sheet.topic,t.root)}}const u=[],p=[];for(const e of a){const t=e.filename.split("/");["attachments","resources"].includes(t[0])&&e.getData&&(u.push(t[1]),p.push(e.getData(new lt.U5,{useWebWorkers:!0})))}return(await Promise.allSettled(p)).forEach(((e,t)=>{"fulfilled"===e.status?dt.set(u[t],e.value):c.ZP.warn(ct.ZP.t("Message.file")+" "+u[t]+" "+ct.ZP.t("Message.loadFails_reasonIs")+e.reason)})),await vt(t.root),await n.close(),t}}var bt=n(631),Et=n(9465),wt=n(1974),kt=n(480);const Ct=()=>{var e;const{t:t}=(0,H.$)(),n=F(),{minder:a,mindOnOff:r,Commands:o}=(0,i.useContext)(B);(0,i.useEffect)((()=>r({"contentchange selectionchange":n})),[r,n]);const l=new Map;return a.getAllNode().forEach((e=>{var t;null===(t=e.getData("extra"))||void 0===t||t.forEach((t=>{var n;l.has(t)?null===(n=l.get(t))||void 0===n||n.push(e):l.set(t,[e])}))})),i.createElement("div",{className:"scroll2list"},i.createElement("div",{className:"node-resources"},null===(e=a.getSelectedNodes())||void 0===e?void 0:e.map(((e,t)=>{var n;return i.createElement("div",{className:"node",key:t,onClick:()=>{o.Camera(e)}},null===(n=e.getData("extra"))||void 0===n?void 0:n.map(((t,n)=>i.createElement("div",{className:"resource",key:n},i.createElement(wt.Z.Text,{type:dt.has(t)?void 0:"danger"},t),i.createElement("div",{className:"operation",onClick:e=>e.stopPropagation()},dt.has(t)?i.createElement(bt.Z,{onClick:()=>{$(dt.get(t),t)}}):"",i.createElement(Et.Z,{onClick:()=>{const t=Array.from(e.getData("extra")??[]);t.splice(n,1),o.Extra(t,e)}}))))))}))),i.createElement(wt.Z.Title,{level:5,style:{display:"inline-block",width:"100%",textAlign:"center"}},t("MainDrawer.allResources")),i.createElement("div",{className:"local-resources"},Array.from(dt.keys()).map(((e,a)=>{var r;return i.createElement("div",{className:"resource",key:a},i.createElement(Ce,{renderOptions:(null===(r=l.get(e))||void 0===r?void 0:r.map((e=>e.getText())))??[],options:l.get(e),onSelect:o.Camera},e),i.createElement("div",{className:"operation"},i.createElement(bt.Z,{onClick:()=>{$(dt.get(e),e)}}),i.createElement(kt.Z,{title:i.createElement(i.Fragment,null,t("Message.FileDeleteConfirm?"),i.createElement("br",null),t("Message.CanNotUndone")),onConfirm:()=>{dt.delete(e),n()}},i.createElement(j.Z,null))))}))))};var xt=n(2906),St=n(2766);const Nt=["text","note","extra"],Zt=(e,t)=>(e&t)===t,Ot=(e,t,n)=>{Zt(n,1)||(e=e.toLowerCase(),t=t.toLowerCase());try{return Zt(n,2)?new RegExp(e).test(t):t.includes(e)}catch(e){return!1}},Tt=e=>{let{regex:t,text:n="",condition:a}=e,r=!1;try{const e=n.split(new RegExp(`(${Zt(a,2)?t:(0,St.Z)(t)})`,Zt(a,1)?"g":"gi"));return i.createElement("span",null,e.map(((e,t)=>(r=!r,i.createElement(i.Fragment,{key:t},r?e:i.createElement("span",{className:"highlight"},e))))))}catch(e){return i.createElement(i.Fragment,null)}},Dt=e=>{let{active:t}=e;const{t:n}=(0,H.$)(),{minder:a,Commands:r,mindOnOff:o}=(0,i.useContext)(B),[l,s]=(0,i.useState)("text"),[c,u]=(0,i.useState)([]),p=(0,i.useRef)(null),m=(0,i.useRef)(null),[g,f]=(0,i.useState)(0),h=(0,i.useCallback)((0,V.Z)((e=>{const t=e.target.value;if(t.length){const e="extra"===l?e=>{const n=e.getData(l)??[];for(const e of n)if(Ot(t,e,g))return!0}:e=>{const n=e.getData(l)??"";return Ot(t,n,g)};u(a.getAllNode().filter(e))}else u([])}),50,{trailing:!0}),[l,g]);(0,i.useEffect)((()=>{if(t){const e=(0,V.Z)((()=>{var e,t;const n=(null===(e=m.current)||void 0===e||null===(t=e.input)||void 0===t?void 0:t.value)??"";h({target:{value:n}})}),250,{trailing:!0});return setTimeout(e),o({contentchange:e})}}),[t,o,h]);const v=(0,i.useCallback)((e=>{var t,n;const a=(null===(t=m.current)||void 0===t?void 0:t.input.value)??"";switch(l){case"text":return i.createElement(Tt,{text:null==e?void 0:e.getData(l),regex:a,condition:g});case"note":{const t=e.getData(l),n=(null==t?void 0:t.indexOf(a))??5;return i.createElement(Tt,{text:null==t?void 0:t.substring(n-5,n+20),regex:a,condition:g})}case"extra":return i.createElement("div",{className:"extra-result"},null===(n=e.getData(l))||void 0===n?void 0:n.map(((e,t)=>i.createElement(Tt,{key:t,text:e,regex:a,condition:g}))))}}),[g,l]),y=(0,i.useMemo)((()=>i.createElement(i.Fragment,null,Nt.map((e=>i.createElement(xt.ZP,{value:e,key:e},n(`Operation.${e}`)))))),[n]);return i.createElement("div",{className:"search-result"},i.createElement(d.Z,{allowClear:!0,onChange:h,onPressEnter:h,ref:m,onFocus:e=>e.target.select(),addonAfter:i.createElement("span",{className:"condition"},i.createElement("div",{className:"case-sensitive "+(Zt(g,1)?"active":""),onClick:()=>{f((e=>1^e))}},"Aa"),i.createElement("div",{className:"regex "+(Zt(g,2)?"active":""),onClick:()=>{f((e=>2^e))}},".*"))}),i.createElement(xt.ZP.Group,{onChange:e=>{let{target:{value:t}}=e;return s(t)},value:l},y),i.createElement("div",{className:"results",ref:p,onClickCapture:e=>{var t,n;let{target:o}=e;for(;o&&"result"!==o.className;){var i;o=null===(i=o)||void 0===i?void 0:i.parentNode}const l=null===(t=o)||void 0===t||null===(n=t.dataset)||void 0===n?void 0:n.index;void 0!==l&&(r.Camera(c[l]),a.select(c[l],!0),r.Expand(!0))}},c.map(((e,t)=>i.createElement("div",{className:"result",key:t,"data-index":t},v(e))))))},Pt=(0,i.forwardRef)(((e,t)=>{let{style:n,onChange:a,...r}=e;return i.createElement("textarea",{ref:t,...r,rows:1,style:{overflow:"inherit",...n,resize:"both"},onChange:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px";const t=getComputedStyle(e.target),n=At(e.target.value,t);e.target.style.width=n+"px",null==a||a(e)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||e.target.blur()}})})),At=(e,t)=>{const n=document.createElement("span");n.style.font=t.font,n.style.whiteSpace="pre",n.style.border=t.border,n.textContent=e,document.body.appendChild(n);const a=n.getBoundingClientRect().width;return document.body.removeChild(n),a+2},{TextArea:Rt}=d.Z,{TabPane:Mt}=u.Z;J.TU.setOptions({gfm:!0,breaks:!0,pedantic:!1,smartLists:!0,smartypants:!1});const Lt=()=>{const{t:e}=(0,H.$)(),t=(0,i.useRef)({root:{data:{text:"Todo",resource:["✔"],hyperlink:"https://www.example.com/"},children:[{data:{text:"Todo"},children:[]},{data:{text:"Todo"},children:[]},{data:{text:"Todo"},children:[]},{data:{text:"Todo"},children:[]}]},template:"default",theme:"fresh-blue",version:"2.0.0",tags:["😄","🙂","😶","😑","🤓","👽","💤","👌","👍","👎","🙏","✍","🦴","🏃","💃","🤺","🚴","🤸","👣","💩","🐾","🐋","🐬","🦈","🐙","🐛","🕸","🍉","🥕","🥚","🍚","🍦","🍺","🥢","🗺","🧭","🏠","🚕","🚧","⚓","🚀","⏳","☀","🌕","⭐","🔥","💧","⚡","♥","♦","✨","⚠","⛔","🚫","❗","❓","❌","✔","⭕","🚩","🏴","🏳"]}),n=(0,i.useRef)(new window.kityminder.Minder({enableAnimation:!0,layoutAnimationDuration:300,viewAnimationDuration:100,zoomAnimationDuration:300,enableKeyReceiver:!0,defaultTheme:"fresh-blue",maxImageWidth:200,maxImageHeight:200,zoom:[25,50,75,100,150,200],expandPos:"in",whiteSpace:"pre",alignByText:"center"})),a=(0,i.useRef)(),r=(0,i.useRef)(),o=(0,i.useRef)(0),l=(0,i.useRef)(null),[s,F]=(0,i.useState)(""),j=(0,i.useRef)(null),[W,G]=(0,i.useState)({visible:!1,value:"",left:"0",top:"0",minWidth:"0",minHeight:"0",fontSize:"unset"}),K=(0,i.useRef)(null),[X,Y]=(0,i.useState)({visible:!1,placeholder:""}),Q=(0,i.useRef)(null),ee=(0,i.useRef)(null),te=(0,i.useRef)(null),[ne,ae]=(0,i.useState)(""),[re,oe]=(0,i.useState)({visible:!1,__html:"",style:{left:"0",top:"0"}}),[ie,ce]=(0,i.useState)({visible:!1}),de=(0,i.useRef)(null),ue=(0,i.useMemo)((()=>Object.fromEntries(q.map((e=>[e,function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return n.current.execCommand(e,...a)}])))),[]),pe=(0,i.useCallback)((e=>{for(const[t,a]of Object.entries(e))n.current.on(t,a);return()=>{for(const[t,a]of Object.entries(e))n.current.off(t,a)}}),[]),me=(0,i.useCallback)(((t,n)=>{const a=dt.has(t);return a?c.ZP.info(e("Message.sameFilename")):dt.set(t,n),a}),[e]),ge=(0,i.useCallback)(((e,t)=>{const n=me(e,t)&&ut.get(e)||URL.createObjectURL(t);ut.set(e,n),ue.Image(n,e)}),[ue,me]),fe=(0,i.useCallback)((t=>Qe(t)||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warn";c.ZP[t](e)}(e("Message.unsupportImage"))),[]),he=(0,i.useCallback)((async t=>{ue.HyperLink(t);try{const r=await fetch(t,{mode:"cors",method:"head"});if(r.ok){var n,a;const e=(null===(n=r.headers.get("Content-Type"))||void 0===n||null===(a=n.match(/image\/\w*/i))||void 0===a?void 0:a[0])??"";if(e.startsWith("image")&&fe(e)){ue.HyperLink(null);const e=t.split("/").pop(),n=await(await fetch(t,{mode:"cors"})).blob();ge(e,n)}}else c.ZP.warn(r.status+e("Message.imageLoadFailButLink"))}catch(t){c.ZP.warn(e("Message.imageLoadFailButLink"))}}),[ue,e,ge,fe]),ve=(0,i.useCallback)((e=>{var t;const n=(null===(t=e.match(/\/\w*/))||void 0===t?void 0:t[0])??"";if(fe(n)){const t=((e,t)=>{const n=window.atob(e.split(",")[1]),a=new Uint8Array(n.length);for(let e=0;e<n.length;e++)a[e]=n.charCodeAt(e);return new Blob([a],{type:`image${t}`})})(e,n),r=URL.createObjectURL(t),o=null!==(a=window.crypto)&&void 0!==a&&a.randomUUID?window.crypto.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>e^window.crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4)).toString(16);dt.set(o,t),ut.set(o,r),ue.Image(r,o)}var a}),[ue,fe]);(0,i.useEffect)((()=>pe({afterimport:()=>{var e;F(""),null===(e=r.current)||void 0===e||e.reset(),ue.ResetLayout(),n.current.select(n.current.getRoot(),!0),n.current.focus()}})),[ue,pe]),(0,i.useEffect)((()=>{n.current.renderTo("#minder"),n.current.importJson(t.current),r.current=new le(n.current)}),[]),(0,i.useEffect)((()=>{var e;return pe({contentchange:null===(e=r.current)||void 0===e?void 0:e.do})}),[pe]),(0,i.useEffect)((()=>pe({contentchange:()=>{clearTimeout(o.current),o.current=window.setTimeout((()=>{p.Z.open({message:"导出保存一下",description:"已经15分钟没有保存了"})}),9e5)}})),[pe]),(0,i.useEffect)((()=>{if(W.visible){const e=(0,V.Z)((()=>{const e=n.current.getSelectedNode().getRenderBox("TextRenderer");G((t=>({...t,left:e.x+"px",top:e.y+"px"})))}),50,{trailing:!0}),t=()=>{var e;null===(e=j.current)||void 0===e||e.blur()};return pe({"layoutallfinish viewchanged":e,contentchange:t,beforemousedown:t})}}),[W.visible,pe]);const ye=(0,i.useCallback)((()=>{const e=n.current.getSelectedNode();if(e){n.current.select(e,!0);const t=e.getRenderBox("TextRenderer"),a=e.getRenderer("TextRenderer")._renderShape.node.getBoundingClientRect(),r=e.getStyle("font-size");n.current.setStatus("textedit"),G({visible:!0,value:e.getText(),fontSize:r+"px",left:t.x+"px",top:t.y+"px",minWidth:a.width+2+"px",minHeight:a.height+6+"px"})}}),[]);(0,i.useEffect)((()=>pe({"normal.dblclick hand.dblclick":ye})),[ye,pe]),(0,i.useEffect)((()=>{var t,n;a.current=new window.HotBox("#minder");const o=a.current.state("main");o.button({position:"center",label:()=>e("Operation.edit"),key:"E",action:ye}),o.button({position:"ring",label:()=>e("Operation.arrangeUp"),key:"Alt+Up",action:ue.ArrangeUp}),o.button({position:"ring",label:()=>e("Operation.appendChild"),key:"Tab",action:()=>ue.AppendChildNode("Todo")}),o.button({position:"ring",label:()=>e("Operation.appendSibling"),key:"Enter",action:()=>{ue.AppendSiblingNode("Todo")}}),o.button({position:"ring",label:()=>e("Operation.arrangeDown"),key:"Alt+Down",action:ue.ArrangeDown}),o.button({position:"ring",label:()=>e("Operation.delete"),key:"Delete",action:ue.RemoveNode}),o.button({position:"ring",label:()=>e("Operation.appendParent"),key:"Shift+Tab",action:()=>{ue.AppendParentNode("Todo")}}),o.button({position:"top",label:()=>e("Operation.progress"),key:"P",next:"progress"}),o.button({position:"top",label:()=>e("Operation.priority"),key:"G",next:"priority"}),o.button({position:"bottom",label:()=>e("Operation.redo"),key:"Ctrl+Y",action:null===(t=r.current)||void 0===t?void 0:t.redo}),o.button({position:"bottom",label:()=>e("Operation.undo"),key:"Ctrl+Z",action:null===(n=r.current)||void 0===n?void 0:n.undo});const i=a.current.state("progress");i.button({position:"center",label:()=>e("Operation.remove"),key:"Delete",action:()=>ue.Progress(0)}),i.button({position:"bottom",label:()=>e("Operation.back"),key:"Esc",next:"back"}),Array(9).fill("").forEach(((e,t)=>{i.button({position:"ring",label:`P${t+1}`,key:t+1+"",action:()=>{ue.Progress(t+1)}})}));const l=a.current.state("priority");return l.button({position:"center",label:()=>e("Operation.remove"),key:"Delete",action:()=>ue.Priority(0)}),l.button({position:"bottom",label:()=>e("Operation.back"),key:"Esc",next:"back"}),Array(9).fill("").forEach(((e,t)=>{l.button({position:"ring",label:`G${t+1}`,key:t+1+"",action:()=>{ue.Priority(t+1)}})})),ct.ZP.on("languageChanged",(()=>{[o,i,l].forEach((e=>e.rerender()))})),()=>ct.ZP.off("languageChanged")}),[ue,ye,e]);const be=(0,i.useCallback)((()=>{var e,t;"idle"!==(null===(e=a.current)||void 0===e?void 0:e.state())&&(null===(t=a.current)||void 0===t||t.active("idle"))}),[]);U(be,(()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.$element})),(0,i.useEffect)((()=>pe({contextmenu:e=>{var t;n.current.getSelectedNode()&&(null===(t=a.current)||void 0===t||t.active("main",e.getPosition("paper")))},"normal.prekeydown normal.prekeyup":e=>{var t,r;if("idle"!==(null===(t=a.current)||void 0===t?void 0:t.state()))a.current.dispatch(e.originEvent),e.stopPropagationImmediately();else if(" "===(null==e||null===(r=e.originEvent)||void 0===r?void 0:r.key)){n.current.select(n.current.getSelectedNode()??[],!0);const t=n.current.getSelectedNode();if(t){var o;const e=t.getRenderBox();null===(o=a.current)||void 0===o||o.active("main",{x:e.x+e.width/2,y:e.y+e.height/2})}e.stopPropagationImmediately()}},"layoutallfinish viewchanged":be})),[be,pe]),(0,i.useEffect)((()=>pe({paste:async t=>{var a;if(null===(a=n.current.getSelectedNodes())||void 0===a||!a.length)return;const{originEvent:{clipboardData:r}}=t;if(t.stopPropagationImmediately(),null!=r&&r.types.includes("Files")){const e=r.files[0];fe(e.name)&&ge(e.name,e)}else if(null!=r&&r.types.includes("text/link-preview")){const e=r.getData("text/plain");await he(e)}else if(null!=r&&r.types.includes("text/plain")){const t=r.getData("text/plain").trim();if(et(t))ve(t);else if(tt(t))try{const e=new URL(t,t.startsWith("//")?window.location.origin:void 0);await he(e.href)}catch(t){c.ZP.warn(e("Message.invalidLink"))}else c.ZP.info(e("Message.imageOrLinkNotRecognized"))}}})),[ue,pe,e,he,ve,ge,fe]),(0,i.useEffect)((()=>pe({DropOnNode:async t=>{const{node:a,originEvent:{dataTransfer:r}}=t;switch(n.current.select(a,!0),!0){case null==r?void 0:r.types.includes("Files"):{var o;const n=null==r?void 0:r.files;if(1===(null==n?void 0:n.length)){const e=n[0];if(Qe(e.type))return ge(e.name,e)}const i=null==r?void 0:r.items;if(!i)return;const l=[],s=null===(o=t.node)||void 0===o?void 0:o.getData("extra");await Promise.allSettled(Array.prototype.map.call(i,(async t=>{if("file"===t.kind)if(window.showOpenFilePicker){const n=await t.getAsFileSystemHandle();if("file"===n.kind){const e=await n.getFile();null!=s&&s.includes(e.name)||(l.push(e.name),me(e.name,e))}else"directory"===n.kind&&c.ZP.warn(e("Message.directoryNotSupported"))}else if(t.webkitGetAsEntry){const a=t.webkitGetAsEntry();if(null!=a&&a.isFile){const e=await(n=a,new Promise(n.file));null!=s&&s.includes(e.name)||(l.push(e.name),me(e.name,e))}else null!=a&&a.isDirectory&&c.ZP.warn(e("Message.directoryNotSupported"))}var n}))),l.length&&ue.Extra((s??[]).concat(l),a)}break;case null==r?void 0:r.types.includes("text/uri-list"):{const e=r.getData("text/uri-list").trim();et(e)?ve(e):await he(e)}break;default:c.ZP.info(e("Message.imageOrLinkNotRecognized"))}},click:e=>{var t;const a=e.kityEvent.targetShape.container,r=n.current.getSelectedNode();if("ExtraIcon"===(null==a||null===(t=a.getType)||void 0===t?void 0:t.call(a))){const t=e.getPosition("paper"),n=a.node.textContent;ce({visible:!0,style:{left:t.x+10+"px",top:t.y+10+"px"},onClick:()=>{var e;ue.Extra(null===(e=r.getData("extra"))||void 0===e?void 0:e.filter((e=>e!==n))),ce({visible:!1})}})}},dblclick:e=>{var t;const n=e.kityEvent.targetShape.container;if("ExtraIcon"===(null==n||null===(t=n.getType)||void 0===t?void 0:t.call(n))){e.stopPropagationImmediately();const t=n.node.textContent;$(dt.get(t),t)}}})),[ue,pe,e,he,ve,me,ge,fe]),U((()=>{ce({visible:!1})}),de),(0,i.useEffect)((()=>{if(ie.visible)return pe({"layoutallfinish viewchanged":()=>ce({visible:!1})})}),[ie.visible,pe]);const Ee=(0,i.useCallback)((0,V.Z)(ue.Note,250,{trailing:!0}),[]);(0,i.useEffect)((()=>{Ee(ne)}),[ne,Ee]),(0,i.useEffect)((()=>pe({click:e=>{var t,a;"NoteIcon"===(null===(t=e.kityEvent.targetShape.container)||void 0===t||null===(a=t.getType)||void 0===a?void 0:a.call(t))&&(n.current.select(n.current.getSelectedNode()??[],!0),ae(n.current.queryCommandValue("Note")),F("note"))}})),[pe]),(0,i.useEffect)((()=>{if("note"===s)return pe({selectionchange:()=>{n.current.select(n.current.getSelectedNode()??[],!0),ae(n.current.queryCommandValue("Note"))}})}),[pe,s]),(0,i.useEffect)((()=>{let e=0;return pe({shownoterequest:t=>{const n=t.icon.getRenderBox("paper"),a=n.x+"px",r=n.y+31+"px";e=window.setTimeout((()=>{oe({now:t,visible:!0,__html:(0,J.TU)(t.node.getData("note")),style:{left:a,top:r}})}),100)},hidenoterequest:()=>{clearTimeout(e)}})}),[pe]),(0,i.useEffect)((()=>{if(!re.visible)return;const e=()=>{oe((e=>({...e,visible:!1})))},t=(0,V.Z)((()=>{const e=re.now.icon.getRenderBox("paper"),t=e.x+"px",n=e.y+31+"px";oe((e=>({...e,style:{left:t,top:n}})))}),50,{trailing:!0});return pe({"layoutallfinish viewchanged":t,contentchange:e,beforemousedown:e})}),[re.visible,re.now,pe]),(0,i.useEffect)((()=>{n.current.addShortcut("Ctrl+Y",r.current.redo),n.current.addShortcut("Ctrl+Z",r.current.undo),n.current.addShortcut("E",ye),n.current.addShortcut("Ctrl+F",(()=>{F("search")})),n.current.addCommandShortcutKeys("Copy","Ctrl+C"),n.current.addCommandShortcutKeys("Cut","Ctrl+X"),n.current.addCommandShortcutKeys("Paste","Ctrl+V",!0),n.current.addShortcut("Enter",(()=>ue.AppendSiblingNode("Todo"))),n.current.addShortcut("Tab|Insert",(()=>ue.AppendChildNode("Todo"))),n.current.addShortcut("Shift+Tab",(()=>ue.AppendParentNode("Todo")));const e=e=>{"Process"===e.key&&(n.current.dispatchKeyEvent(Object.defineProperties(e,{key:{value:"/"},keyCode:{value:191}})),e.stopPropagation())};return document.body.addEventListener("keydown",e,!0),()=>document.body.removeEventListener("keydown",e,!0)}),[ue,ye]),(0,i.useEffect)((()=>{var e;const t=null===(e=location.hash.split("/"))||void 0===e?void 0:e[1];t&&n.current.importJson(JSON.parse(se.decompressFromEncodedURIComponent(t)??""))}),[]);const we=(0,i.useMemo)((()=>({id:()=>!0,created:()=>!0,text:e=>{let{text:t}=e;return!t.length},expandState:e=>{let{expandState:t}=e;return"expand"===t},progress:e=>{let{progress:t}=e;return t<1||t>9},hyperlink:e=>{let{hyperlink:t}=e;return!t.length},hyperlinkTitle:()=>!0,resource:e=>{let{resource:t}=e;return!t.length},priority:e=>{let{priority:t}=e;return t<1||t>9},note:e=>{let{note:t}=e;return!t.length},image:e=>{let{image:t}=e;return!/^(https?:)?\/\//.test(t)},imageTitle:e=>{let{image:t}=e;return!t||!/^(https?:)?\/\//.test(t)},imageSize:e=>{let{image:t}=e;return!t||!/^(https?:)?\/\//.test(t)},extra:()=>!0})),[]);(0,i.useEffect)((()=>{console.log("minder",window.minder=n.current),console.log("FileResources",window.FileResources={filename2blob:dt,filename2objectUrl:ut})}),[]);const ke=(0,i.useMemo)((()=>({km:async e=>JSON.parse(await e.text()),xmind:async e=>await yt.parseXmind(e),km2:async e=>await yt.parseKm2(e)})),[]),Ce=(0,i.useCallback)((async a=>{const r=null==a?void 0:a[0],o=(null==r?void 0:r.name.split(".").pop())??"";if(r&&Object.keys(ke).includes(o)){dt.clear(),ut.forEach(URL.revokeObjectURL),ut.clear();try{var i;const e=await(null===(i=ke[o])||void 0===i?void 0:i.call(ke,r))??t.current;n.current.importJson(e)}catch(t){c.ZP.warn(e("Message.fail2import"))}}else c.ZP.warn(e("Message.unsupportFile"))}),[ke,e]),xe=_({dataTransfer:{type:"Text"}}),Se=_({dataTransfer:{type:"HyperLink"}}),Ne=_({dataTransfer:{type:"Image"}}),Ze=_({dataTransfer:{type:"Resource"}}),Oe=_({dataTransfer:{type:"Note"}}),Te=_({dataTransfer:{type:"Extra"}}),De=I({onDrop:e=>{const t=e.dataTransfer.getData("type");ue[t](null),e.stopPropagation()}}),Pe=I({onDrop:e=>{Ce(e.dataTransfer.files),e.stopPropagation(),e.preventDefault()}});return i.createElement(B.Provider,{value:{minder:n.current,Commands:ue,mindOnOff:pe}},i.createElement("div",{className:"minder"},i.createElement("div",{className:"operate"},i.createElement("div",{className:"ports"},i.createElement(m.Z,{type:"link",onClick:async()=>{var t;const a=n.current.exportJson();a.tags=null===(t=l.current)||void 0===t?void 0:t.getLatestTag();const r=e=>{let t,{data:n,children:a}=e;for(t in n)if(Object.prototype.hasOwnProperty.call(we,t)){if(null==n[t]){Reflect.deleteProperty(n,t);continue}we[t](n)&&Reflect.deleteProperty(n,t)}a.forEach(r)};r(a.root);const o=window.location.origin+window.location.pathname+"#share/"+se.compressToEncodedURIComponent(JSON.stringify(a));try{await(async e=>{if(navigator.clipboard)await navigator.clipboard.writeText(e);else{const t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}})(o),c.ZP.success({content:e("Message.copy2clipboard"),style:{paddingTop:"40vh"},duration:1.5})}catch(t){c.ZP.warn(e("Message.fail2share"))}},icon:i.createElement(h.Z,{rotate:3===(new Date).getMonth()&&1===(new Date).getDate()?180:0})},e("Operation.share")),i.createElement(m.Z,{icon:i.createElement(v.Z,null),type:"text",onClick:async()=>{var t;const a=n.current.exportJson();a.tags=null===(t=l.current)||void 0===t?void 0:t.getLatestTag();const r=new lt.U5("application/km2"),i=new lt._Q(r,{useWebWorkers:!0,bufferedWrite:!0}),s=[],d=e=>{var t;let{data:n,children:a}=e;if(n.image&&n.imageTitle){const e=dt.get(n.imageTitle);e&&(n.image=n.imageTitle,s.push(i.add("files/"+n.imageTitle,new lt.Nt(e))))}null!==(t=n.extra)&&void 0!==t&&t.length&&n.extra.forEach((e=>{const t=dt.get(e);t&&s.push(i.add("files/"+e,new lt.Nt(t)))})),a.forEach(d)};d(a.root),s.unshift(i.add("content.json",new lt.CU(JSON.stringify(a))));try{await Promise.all(s)}catch(t){c.ZP.warn(e("Message.fail2export"))}await i.close(),$(await r.getData(),(n.current.getMinderTitle()||"Todo")+".km2"),clearTimeout(o.current)}},e("Operation.export")),i.createElement(m.Z,{icon:i.createElement(y.Z,null),type:"text",onClick:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.click()}},e("Operation.import"),i.createElement("input",{accept:".km,.km2,.xmind",ref:Q,type:"file",style:{display:"none"},onChange:e=>{let{target:{files:t}}=e;Ce(t)}}))),i.createElement("div",{className:"do"},i.createElement(m.Z,{icon:i.createElement(b.Z,null),type:"text",onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.redo()}},e("Operation.redo")),i.createElement(m.Z,{icon:i.createElement(E.Z,null),type:"text",onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.undo()}},e("Operation.undo")),i.createElement(m.Z,{icon:i.createElement(w.Z,null),type:"text",onClick:()=>{F("search")}},e("Operation.search"))),i.createElement("div",{className:"nodes"},i.createElement(m.Z,{icon:i.createElement(k.Z,{rotate:180}),type:"text",onClick:()=>ue.AppendParentNode("Todo")},e("Operation.appendParent")),i.createElement(m.Z,{icon:i.createElement(C.Z,null),type:"text",onClick:()=>ue.AppendSiblingNode("Todo")},e("Operation.appendSibling")),i.createElement(m.Z,{icon:i.createElement(k.Z,null),type:"text",onClick:()=>ue.AppendChildNode("Todo")},e("Operation.appendChild"))),i.createElement("div",{className:"move"},i.createElement(m.Z,{icon:i.createElement(x.Z,null),type:"text",onClick:ue.ArrangeUp},e("Operation.arrangeUp")),i.createElement(m.Z,{icon:i.createElement(S.Z,null),type:"text",onClick:ue.ArrangeDown},e("Operation.arrangeDown")),i.createElement(m.Z,{icon:i.createElement(N.Z,null),type:"text",onClick:ue.RemoveNode},e("Operation.delete"))),i.createElement("div",{className:"multi"},i.createElement("div",{className:"media"},i.createElement(m.Z,{icon:i.createElement(Z.Z,null),type:"text",...xe,onClick:ye}," ",e("Operation.text")),i.createElement(m.Z,{icon:i.createElement(O.Z,null),type:"text",...Se,onClick:()=>{Y({visible:!0,placeholder:e("Operation.linkHint"),onBlur:e=>{let{target:{value:t}}=e;Y((e=>({...e,visible:!1})));const n=t.trim();n&&ue.HyperLink(n)}})}},e("Operation.link")),i.createElement(g.Z,{placement:"rightTop",content:e("Operation.imageUploadHint")},i.createElement(m.Z,{icon:i.createElement(T.Z,null),type:"text",...Ne,onDoubleClick:()=>{var e;return null===(e=ee.current)||void 0===e?void 0:e.click()},onClick:()=>{Y({visible:!0,placeholder:e("Operation.imageHint"),onBlur:async t=>{let{target:{value:n}}=t;Y((e=>({...e,visible:!1})));const a=n.trim(),r=a.split("/").pop();if(r)try{let e;if(dt.has(r))c.ZP.info("Message.sameFilename"),e=ut.get(r)??URL.createObjectURL(dt.get(r));else{var o,i;const t=await fetch(a,{mode:"cors"}),n=(null===(o=t.headers.get("Content-Type"))||void 0===o||null===(i=o.match(/\/\w*/i))||void 0===i?void 0:i[0])??"";if(!fe(n))return;const l=await t.blob();dt.set(r,l),e=URL.createObjectURL(l)}ut.set(r,e),ue.Image(e,r)}catch(t){c.ZP.warn(e("Message.imageLoadFail_UseLinkInstead")),ue.Image(a,r)}}})}},e("Operation.image"),i.createElement("input",{ref:ee,accept:".jpg,.jpeg,.png,.gif",type:"file",hidden:!0,onChange:e=>{let{target:{files:t}}=e;const n=null==t?void 0:t[0];n&&fe(n.name)&&ge(n.name,n)}}))),i.createElement(m.Z,{icon:i.createElement(D.Z,null),type:"text",...Ze,onClick:()=>{F("tag")}},e("Operation.tag")),i.createElement(m.Z,{icon:i.createElement(P.Z,null),type:"text",...Oe,onClick:()=>{F("note"),n.current.select(n.current.getSelectedNode()??[],!0),ae(n.current.queryCommandValue("Note"))}},e("Operation.note")),i.createElement(m.Z,{icon:i.createElement(A.Z,null),type:"text",...Te,onClick:()=>{var t,a;null!==(t=n.current.getSelectedNodes())&&void 0!==t&&t.length?null===(a=te.current)||void 0===a||a.click():(F("extra"),c.ZP.info(e("Message.NoNodeSelected")))}},e("Operation.extra"),i.createElement("input",{ref:te,multiple:!0,type:"file",hidden:!0,onChange:t=>{let{target:{files:a}}=t;const r=n.current.getSelectedNodes();if(null==a||!a.length||null==r||!r.length)return c.ZP.info(e("Message.NoFileUploaded_NoNodeSelected"));const o=[];for(const e of a)o.push(e.name),me(e.name,e);r.forEach((e=>{const t=e.getData("extra")??[],n=new Set(t.concat(o));ue.Extra(Array.from(n),e)}))},onClick:e=>e.target.value=null}))),X.visible?i.createElement(d.Z,{autoFocus:!0,placeholder:X.placeholder,ref:K,onBlur:X.onBlur}):i.createElement("div",{className:"remove",...De},i.createElement(R.Z,null))),i.createElement("div",{className:"priorities",onClickCapture:e=>{ue.Priority(+e.target.innerText)}},Array(10).fill("").map(((e,t)=>i.createElement("div",{className:"priority",style:{backgroundPositionY:20*-t},key:t},t)))),i.createElement("div",{className:"progresses",onClickCapture:e=>{ue.Progress(+e.target.innerText)}},Array(10).fill("").map(((e,t)=>i.createElement("div",{className:"progress",style:{backgroundPositionY:20*-t},key:t},t)))),i.createElement("div",{className:"colors",onClickCapture:e=>{let{target:t}=e;ue.Background(t.style.backgroundColor)}},[0,25,122,204,246,334].map((e=>[`hsl(${e}, 37%, 60%)`,`hsl(${e}, 33%, 95%)`])).flat().concat(["#e9df98","#a4c5c0","rgb(254, 219, 0)","#99ca6a","#999","gray","black","white","transparent"]).map((e=>i.createElement("div",{className:"color",style:{backgroundColor:e},key:e}))),i.createElement(m.Z,{icon:i.createElement(M.Z,null),type:"text",onClick:()=>{var e;return null===(e=n.current.getSelectedNodes())||void 0===e?void 0:e.forEach((e=>e.resetBackground()))}},e("Operation.reset")))),i.createElement("div",{id:"minder",...Pe,onContextMenu:e=>e.preventDefault()},W.visible?i.createElement(Pt,{style:{position:"absolute",padding:0,fontSize:W.fontSize,minWidth:W.minWidth,minHeight:W.minHeight,left:W.left,top:W.top},ref:j,autoFocus:!0,defaultValue:W.value,onFocus:e=>e.target.select(),onBlur:e=>{n.current.setStatus("normal"),G((e=>({...e,visible:!1}))),ue.Text(e.target.value),n.current.focus()}}):"",i.createElement(f.Z,{placement:"left",getContainer:!1,mask:!1,closable:!1,visible:["search","tag","note","extra"].includes(s),style:{position:"absolute"},width:"320px",bodyStyle:{padding:"5px 10px"}},i.createElement(u.Z,{tabBarGutter:10,activeKey:s,onTabClick:e=>F(e),tabBarExtraContent:i.createElement(L.Z,{className:"closeIcon",onClick:()=>F("")})},i.createElement(Mt,{tab:e("Operation.search"),key:"search"},i.createElement(Dt,{active:"search"===s})),i.createElement(Mt,{tab:e("Operation.tag"),key:"tag"},i.createElement(z,{tags:t.current.tags??[],ref:l})),i.createElement(Mt,{tab:e("Operation.note"),key:"note"},i.createElement("div",{className:"scrollarea"},i.createElement(Rt,{allowClear:!0,showCount:!0,autoSize:!0,value:ne,onChange:e=>{let{target:{value:t}}=e;ae(t)}}),i.createElement(m.Z,{className:"textarea-hint",type:"link",target:"_blank",href:"https://guides.github.com/features/mastering-markdown/"},e("Message.GFMSupported")))),i.createElement(Mt,{tab:e("Operation.extra"),key:"extra"},i.createElement(Ct,null)))),re.visible?i.createElement("div",{className:"previewNote",style:re.style,dangerouslySetInnerHTML:{__html:re.__html}}):"",ie.visible?i.createElement(m.Z,{danger:!0,ref:de,style:{position:"absolute",...ie.style},onClick:ie.onClick},e("Operation.remove")):""),i.createElement(it,null)))};var Ft=n(8718),Ut=n(2925),_t=n(8253);n(5057),n(7033),n(9598);const It=Object.keys(o).find((e=>e.toLowerCase().split("_")[0]===navigator.language.toLowerCase().split("-")[0]))??"zh_CN";ct.ZP.use(Ft.Db).init({resources:Object.fromEntries(Object.entries(o).map((e=>{let[t,n]=e;return[t.replaceAll("_","-"),{translation:n}]}))),lng:It.replace("_","-"),interpolation:{escapeValue:!1},debug:!1});const jt={zh_CN:Ut.Z,en_US:_t.Z};l.render(i.createElement((()=>{const[e,t]=(0,i.useState)(jt[It]);return i.createElement(W.Provider,{value:e=>{ct.ZP.changeLanguage(e.replaceAll("_","-")),t(jt[e])}},i.createElement(s.ZP,{componentSize:"small",locale:e},i.createElement(Lt,null)))}),null),document.getElementById("root"))}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return t[e](o,o.exports,a),o.loaded=!0,o.exports}a.m=t,e=[],a.O=function(t,n,r,o){if(!n){var i=1/0;for(d=0;d<e.length;d++){n=e[d][0],r=e[d][1],o=e[d][2];for(var l=!0,s=0;s<n.length;s++)(!1&o||i>=o)&&Object.keys(a.O).every((function(e){return a.O[e](n[s])}))?n.splice(s--,1):(l=!1,o<i&&(i=o));if(l){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,r,o]},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},function(){var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e}(),function(){var e={826:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,o,i=n[0],l=n[1],s=n[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(s)var d=s(a)}for(t&&t(n);c<i.length;c++)o=i[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},n=self.webpackChunkmind_editor=self.webpackChunkmind_editor||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var r=a.O(void 0,[904,216],(function(){return a(6630)}));return a.O(r)}()}));